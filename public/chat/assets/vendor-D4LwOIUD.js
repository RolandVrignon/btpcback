function Ne(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var G={exports:{}},g={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var re;function Oe(){if(re)return g;re=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),m=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),a=Symbol.for("react.suspense"),n=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),l=Symbol.iterator;function S(r){return r===null||typeof r!="object"?null:(r=l&&r[l]||r["@@iterator"],typeof r=="function"?r:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,O={};function k(r,s,y){this.props=r,this.context=s,this.refs=O,this.updater=y||R}k.prototype.isReactComponent={},k.prototype.setState=function(r,s){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,s,"setState")},k.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function b(){}b.prototype=k.prototype;function D(r,s,y){this.props=r,this.context=s,this.refs=O,this.updater=y||R}var P=D.prototype=new b;P.constructor=D,C(P,k.prototype),P.isPureReactComponent=!0;var L=Array.isArray,d={H:null,A:null,T:null,S:null},c=Object.prototype.hasOwnProperty;function I(r,s,y,_,w,v){return y=v.ref,{$$typeof:e,type:r,key:s,ref:y!==void 0?y:null,props:v}}function A(r,s){return I(r.type,s,void 0,void 0,void 0,r.props)}function T(r){return typeof r=="object"&&r!==null&&r.$$typeof===e}function Y(r){var s={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(y){return s[y]})}var Z=/\/+/g;function K(r,s){return typeof r=="object"&&r!==null&&r.key!=null?Y(""+r.key):s.toString(36)}function ee(){}function ve(r){switch(r.status){case"fulfilled":return r.value;case"rejected":throw r.reason;default:switch(typeof r.status=="string"?r.then(ee,ee):(r.status="pending",r.then(function(s){r.status==="pending"&&(r.status="fulfilled",r.value=s)},function(s){r.status==="pending"&&(r.status="rejected",r.reason=s)})),r.status){case"fulfilled":return r.value;case"rejected":throw r.reason}}throw r}function U(r,s,y,_,w){var v=typeof r;(v==="undefined"||v==="boolean")&&(r=null);var h=!1;if(r===null)h=!0;else switch(v){case"bigint":case"string":case"number":h=!0;break;case"object":switch(r.$$typeof){case e:case t:h=!0;break;case u:return h=r._init,U(h(r._payload),s,y,_,w)}}if(h)return w=w(r),h=_===""?"."+K(r,0):_,L(w)?(y="",h!=null&&(y=h.replace(Z,"$&/")+"/"),U(w,s,y,"",function(ke){return ke})):w!=null&&(T(w)&&(w=A(w,y+(w.key==null||r&&r.key===w.key?"":(""+w.key).replace(Z,"$&/")+"/")+h)),s.push(w)),1;h=0;var M=_===""?".":_+":";if(L(r))for(var N=0;N<r.length;N++)_=r[N],v=M+K(_,N),h+=U(_,s,y,v,w);else if(N=S(r),typeof N=="function")for(r=N.call(r),N=0;!(_=r.next()).done;)_=_.value,v=M+K(_,N++),h+=U(_,s,y,v,w);else if(v==="object"){if(typeof r.then=="function")return U(ve(r),s,y,_,w);throw s=String(r),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.")}return h}function q(r,s,y){if(r==null)return r;var _=[],w=0;return U(r,_,"","",function(v){return s.call(y,v,w++)}),_}function Ce(r){if(r._status===-1){var s=r._result;s=s(),s.then(function(y){(r._status===0||r._status===-1)&&(r._status=1,r._result=y)},function(y){(r._status===0||r._status===-1)&&(r._status=2,r._result=y)}),r._status===-1&&(r._status=0,r._result=s)}if(r._status===1)return r._result.default;throw r._result}var te=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function be(){}return g.Children={map:q,forEach:function(r,s,y){q(r,function(){s.apply(this,arguments)},y)},count:function(r){var s=0;return q(r,function(){s++}),s},toArray:function(r){return q(r,function(s){return s})||[]},only:function(r){if(!T(r))throw Error("React.Children.only expected to receive a single React element child.");return r}},g.Component=k,g.Fragment=o,g.Profiler=p,g.PureComponent=D,g.StrictMode=i,g.Suspense=a,g.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=d,g.act=function(){throw Error("act(...) is not supported in production builds of React.")},g.cache=function(r){return function(){return r.apply(null,arguments)}},g.cloneElement=function(r,s,y){if(r==null)throw Error("The argument must be a React element, but you passed "+r+".");var _=C({},r.props),w=r.key,v=void 0;if(s!=null)for(h in s.ref!==void 0&&(v=void 0),s.key!==void 0&&(w=""+s.key),s)!c.call(s,h)||h==="key"||h==="__self"||h==="__source"||h==="ref"&&s.ref===void 0||(_[h]=s[h]);var h=arguments.length-2;if(h===1)_.children=y;else if(1<h){for(var M=Array(h),N=0;N<h;N++)M[N]=arguments[N+2];_.children=M}return I(r.type,w,void 0,void 0,v,_)},g.createContext=function(r){return r={$$typeof:m,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null},r.Provider=r,r.Consumer={$$typeof:E,_context:r},r},g.createElement=function(r,s,y){var _,w={},v=null;if(s!=null)for(_ in s.key!==void 0&&(v=""+s.key),s)c.call(s,_)&&_!=="key"&&_!=="__self"&&_!=="__source"&&(w[_]=s[_]);var h=arguments.length-2;if(h===1)w.children=y;else if(1<h){for(var M=Array(h),N=0;N<h;N++)M[N]=arguments[N+2];w.children=M}if(r&&r.defaultProps)for(_ in h=r.defaultProps,h)w[_]===void 0&&(w[_]=h[_]);return I(r,v,void 0,void 0,null,w)},g.createRef=function(){return{current:null}},g.forwardRef=function(r){return{$$typeof:f,render:r}},g.isValidElement=T,g.lazy=function(r){return{$$typeof:u,_payload:{_status:-1,_result:r},_init:Ce}},g.memo=function(r,s){return{$$typeof:n,type:r,compare:s===void 0?null:s}},g.startTransition=function(r){var s=d.T,y={};d.T=y;try{var _=r(),w=d.S;w!==null&&w(y,_),typeof _=="object"&&_!==null&&typeof _.then=="function"&&_.then(be,te)}catch(v){te(v)}finally{d.T=s}},g.unstable_useCacheRefresh=function(){return d.H.useCacheRefresh()},g.use=function(r){return d.H.use(r)},g.useActionState=function(r,s,y){return d.H.useActionState(r,s,y)},g.useCallback=function(r,s){return d.H.useCallback(r,s)},g.useContext=function(r){return d.H.useContext(r)},g.useDebugValue=function(){},g.useDeferredValue=function(r,s){return d.H.useDeferredValue(r,s)},g.useEffect=function(r,s){return d.H.useEffect(r,s)},g.useId=function(){return d.H.useId()},g.useImperativeHandle=function(r,s,y){return d.H.useImperativeHandle(r,s,y)},g.useInsertionEffect=function(r,s){return d.H.useInsertionEffect(r,s)},g.useLayoutEffect=function(r,s){return d.H.useLayoutEffect(r,s)},g.useMemo=function(r,s){return d.H.useMemo(r,s)},g.useOptimistic=function(r,s){return d.H.useOptimistic(r,s)},g.useReducer=function(r,s,y){return d.H.useReducer(r,s,y)},g.useRef=function(r){return d.H.useRef(r)},g.useState=function(r){return d.H.useState(r)},g.useSyncExternalStore=function(r,s,y){return d.H.useSyncExternalStore(r,s,y)},g.useTransition=function(){return d.H.useTransition()},g.version="19.0.0",g}var ne;function xe(){return ne||(ne=1,G.exports=Oe()),G.exports}var W={exports:{}},x={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oe;function De(){if(oe)return x;oe=1;var e=xe();function t(a){var n="https://react.dev/errors/"+a;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)n+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var i={d:{f:o,r:function(){throw Error(t(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},p=Symbol.for("react.portal");function E(a,n,u){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:p,key:l==null?null:""+l,children:a,containerInfo:n,implementation:u}}var m=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(a,n){if(a==="font")return"";if(typeof n=="string")return n==="use-credentials"?n:""}return x.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,x.createPortal=function(a,n){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)throw Error(t(299));return E(a,n,null,u)},x.flushSync=function(a){var n=m.T,u=i.p;try{if(m.T=null,i.p=2,a)return a()}finally{m.T=n,i.p=u,i.d.f()}},x.preconnect=function(a,n){typeof a=="string"&&(n?(n=n.crossOrigin,n=typeof n=="string"?n==="use-credentials"?n:"":void 0):n=null,i.d.C(a,n))},x.prefetchDNS=function(a){typeof a=="string"&&i.d.D(a)},x.preinit=function(a,n){if(typeof a=="string"&&n&&typeof n.as=="string"){var u=n.as,l=f(u,n.crossOrigin),S=typeof n.integrity=="string"?n.integrity:void 0,R=typeof n.fetchPriority=="string"?n.fetchPriority:void 0;u==="style"?i.d.S(a,typeof n.precedence=="string"?n.precedence:void 0,{crossOrigin:l,integrity:S,fetchPriority:R}):u==="script"&&i.d.X(a,{crossOrigin:l,integrity:S,fetchPriority:R,nonce:typeof n.nonce=="string"?n.nonce:void 0})}},x.preinitModule=function(a,n){if(typeof a=="string")if(typeof n=="object"&&n!==null){if(n.as==null||n.as==="script"){var u=f(n.as,n.crossOrigin);i.d.M(a,{crossOrigin:u,integrity:typeof n.integrity=="string"?n.integrity:void 0,nonce:typeof n.nonce=="string"?n.nonce:void 0})}}else n==null&&i.d.M(a)},x.preload=function(a,n){if(typeof a=="string"&&typeof n=="object"&&n!==null&&typeof n.as=="string"){var u=n.as,l=f(u,n.crossOrigin);i.d.L(a,u,{crossOrigin:l,integrity:typeof n.integrity=="string"?n.integrity:void 0,nonce:typeof n.nonce=="string"?n.nonce:void 0,type:typeof n.type=="string"?n.type:void 0,fetchPriority:typeof n.fetchPriority=="string"?n.fetchPriority:void 0,referrerPolicy:typeof n.referrerPolicy=="string"?n.referrerPolicy:void 0,imageSrcSet:typeof n.imageSrcSet=="string"?n.imageSrcSet:void 0,imageSizes:typeof n.imageSizes=="string"?n.imageSizes:void 0,media:typeof n.media=="string"?n.media:void 0})}},x.preloadModule=function(a,n){if(typeof a=="string")if(n){var u=f(n.as,n.crossOrigin);i.d.m(a,{as:typeof n.as=="string"&&n.as!=="script"?n.as:void 0,crossOrigin:u,integrity:typeof n.integrity=="string"?n.integrity:void 0})}else i.d.m(a)},x.requestFormReset=function(a){i.d.r(a)},x.unstable_batchedUpdates=function(a,n){return a(n)},x.useFormState=function(a,n,u){return m.H.useFormState(a,n,u)},x.useFormStatus=function(){return m.H.useHostTransitionStatus()},x.version="19.0.0",x}var ae;function Nt(){if(ae)return W.exports;ae=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),W.exports=De(),W.exports}var pe="vercel.ai.error",Pe=Symbol.for(pe),de,Le=class ye extends Error{constructor({name:t,message:o,cause:i}){super(o),this[de]=!0,this.name=t,this.cause=i}static isInstance(t){return ye.hasMarker(t,pe)}static hasMarker(t,o){const i=Symbol.for(o);return t!=null&&typeof t=="object"&&i in t&&typeof t[i]=="boolean"&&t[i]===!0}};de=Pe;var B=Le;function _e(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var ge="AI_InvalidArgumentError",Ee=`vercel.ai.error.${ge}`,Me=Symbol.for(Ee),me,je=class extends B{constructor({message:e,cause:t,argument:o}){super({name:ge,message:e,cause:t}),this[me]=!0,this.argument=o}static isInstance(e){return B.hasMarker(e,Ee)}};me=Me;var he="AI_JSONParseError",Ie=`vercel.ai.error.${he}`,Ue=Symbol.for(Ie),Te,se=class extends B{constructor({text:e,cause:t}){super({name:he,message:`JSON parsing failed: Text: ${e}.
Error message: ${_e(t)}`,cause:t}),this[Te]=!0,this.text=e}static isInstance(e){return B.hasMarker(e,Ie)}};Te=Ue;var we="AI_TypeValidationError",Re=`vercel.ai.error.${we}`,Be=Symbol.for(Re),Se,Ye=class z extends B{constructor({value:t,cause:o}){super({name:we,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${_e(o)}`,cause:o}),this[Se]=!0,this.value=t}static isInstance(t){return B.hasMarker(t,Re)}static wrap({value:t,cause:o}){return z.isInstance(o)&&o.value===t?o:new z({value:t,cause:o})}};Se=Be;var ie=Ye;let Fe=(e,t=21)=>(o=t)=>{let i="",p=o|0;for(;p--;)i+=e[Math.random()*e.length|0];return i};var j={exports:{}},ce;function Je(){if(ce)return j.exports;ce=1;const e=typeof Buffer<"u",t=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,o=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function i(f,a,n){n==null&&a!==null&&typeof a=="object"&&(n=a,a=void 0),e&&Buffer.isBuffer(f)&&(f=f.toString()),f&&f.charCodeAt(0)===65279&&(f=f.slice(1));const u=JSON.parse(f,a);if(u===null||typeof u!="object")return u;const l=n&&n.protoAction||"error",S=n&&n.constructorAction||"error";if(l==="ignore"&&S==="ignore")return u;if(l!=="ignore"&&S!=="ignore"){if(t.test(f)===!1&&o.test(f)===!1)return u}else if(l!=="ignore"&&S==="ignore"){if(t.test(f)===!1)return u}else if(o.test(f)===!1)return u;return p(u,{protoAction:l,constructorAction:S,safe:n&&n.safe})}function p(f,{protoAction:a="error",constructorAction:n="error",safe:u}={}){let l=[f];for(;l.length;){const S=l;l=[];for(const R of S){if(a!=="ignore"&&Object.prototype.hasOwnProperty.call(R,"__proto__")){if(u===!0)return null;if(a==="error")throw new SyntaxError("Object contains forbidden prototype property");delete R.__proto__}if(n!=="ignore"&&Object.prototype.hasOwnProperty.call(R,"constructor")&&Object.prototype.hasOwnProperty.call(R.constructor,"prototype")){if(u===!0)return null;if(n==="error")throw new SyntaxError("Object contains forbidden prototype property");delete R.constructor}for(const C in R){const O=R[C];O&&typeof O=="object"&&l.push(O)}}}return f}function E(f,a,n){const u=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(f,a,n)}finally{Error.stackTraceLimit=u}}function m(f,a){const n=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return i(f,a,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=n}}return j.exports=E,j.exports.default=E,j.exports.parse=E,j.exports.safeParse=m,j.exports.scan=p,j.exports}var $e=Je();const Ve=Ne($e);var He=({prefix:e,size:t=16,alphabet:o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:i="-"}={})=>{const p=Fe(o,t);if(e==null)return p;if(o.includes(i))throw new je({argument:"separator",message:`The separator "${i}" must not be part of the alphabet "${o}".`});return E=>`${e}${i}${p(E)}`},Ae=He(),X=Symbol.for("vercel.ai.validator");function qe(e){return{[X]:!0,validate:e}}function Ke(e){return typeof e=="object"&&e!==null&&X in e&&e[X]===!0&&"validate"in e}function Ge(e){return Ke(e)?e:We(e)}function We(e){return qe(t=>{const o=e.safeParse(t);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}})}function ze({value:e,schema:t}){const o=Ge(t);try{if(o.validate==null)return{success:!0,value:e};const i=o.validate(e);return i.success?i:{success:!1,error:ie.wrap({value:e,cause:i.error})}}catch(i){return{success:!1,error:ie.wrap({value:e,cause:i})}}}function ue({text:e,schema:t}){try{const o=Ve.parse(e);if(t==null)return{success:!0,value:o,rawValue:o};const i=ze({value:o,schema:t});return i.success?{...i,rawValue:o}:i}catch(o){return{success:!1,error:se.isInstance(o)?o:new se({text:e,cause:o})}}}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var F={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},J={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},$={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},V={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},H={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},Xe=[F,J,$,V,H];F.code+"",J.code+"",$.code+"",V.code+"",H.code+"";F.name+"",F.code,J.name+"",J.code,$.name+"",$.code,V.name+"",V.code,H.name+"",H.code;Xe.map(e=>e.code);function Qe({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function Ze(e){const t=["ROOT"];let o=-1,i=null;function p(a,n,u){switch(a){case'"':{o=n,t.pop(),t.push(u),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{o=n,i=n,t.pop(),t.push(u),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(u),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{o=n,t.pop(),t.push(u),t.push("INSIDE_NUMBER");break}case"{":{o=n,t.pop(),t.push(u),t.push("INSIDE_OBJECT_START");break}case"[":{o=n,t.pop(),t.push(u),t.push("INSIDE_ARRAY_START");break}}}function E(a,n){switch(a){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{o=n,t.pop();break}}}function m(a,n){switch(a){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{o=n,t.pop();break}}}for(let a=0;a<e.length;a++){const n=e[a];switch(t[t.length-1]){case"ROOT":p(n,a,"FINISH");break;case"INSIDE_OBJECT_START":{switch(n){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{o=a,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(n){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(n){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(n){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{p(n,a,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{E(n,a);break}case"INSIDE_STRING":{switch(n){case'"':{t.pop(),o=a;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:o=a}break}case"INSIDE_ARRAY_START":{switch(n){case"]":{o=a,t.pop();break}default:{o=a,p(n,a,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(n){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{o=a,t.pop();break}default:{o=a;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{p(n,a,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),o=a;break}case"INSIDE_NUMBER":{switch(n){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{o=a;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&m(n,a),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&E(n,a);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&E(n,a);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&m(n,a);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const l=e.substring(i,a+1);!"false".startsWith(l)&&!"true".startsWith(l)&&!"null".startsWith(l)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?E(n,a):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&m(n,a)):o=a;break}}}let f=e.slice(0,o+1);for(let a=t.length-1;a>=0;a--)switch(t[a]){case"INSIDE_STRING":{f+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{f+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{f+="]";break}case"INSIDE_LITERAL":{const u=e.substring(i,e.length);"true".startsWith(u)?f+="true".slice(u.length):"false".startsWith(u)?f+="false".slice(u.length):"null".startsWith(u)&&(f+="null".slice(u.length))}}return f}function et(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=ue({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=ue({text:Ze(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var tt={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},rt={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},nt={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},ot={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},at={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},st={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},it={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},ct={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},ut={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},lt={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},ft={code:"f",name:"start_step",parse:e=>{if(e==null||typeof e!="object"||!("messageId"in e)||typeof e.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},pt={code:"g",name:"reasoning",parse:e=>{if(typeof e!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},dt={code:"h",name:"source",parse:e=>{if(e==null||typeof e!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},yt={code:"i",name:"redacted_reasoning",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},_t={code:"j",name:"reasoning_signature",parse:e=>{if(e==null||typeof e!="object"||!("signature"in e)||typeof e.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},gt={code:"k",name:"file",parse:e=>{if(e==null||typeof e!="object"||!("data"in e)||typeof e.data!="string"||!("mimeType"in e)||typeof e.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}},Q=[tt,rt,nt,ot,at,st,it,ct,ut,lt,ft,pt,dt,yt,_t,gt],Et=Object.fromEntries(Q.map(e=>[e.code,e]));Object.fromEntries(Q.map(e=>[e.name,e.code]));var mt=Q.map(e=>e.code),ht=e=>{const t=e.indexOf(":");if(t===-1)throw new Error("Failed to parse stream string. No separator found.");const o=e.slice(0,t);if(!mt.includes(o))throw new Error(`Failed to parse stream string. Invalid code ${o}.`);const i=o,p=e.slice(t+1),E=JSON.parse(p);return Et[i].parse(E)},It=10;function Tt(e,t){const o=new Uint8Array(t);let i=0;for(const p of e)o.set(p,i),i+=p.length;return e.length=0,o}async function wt({stream:e,onTextPart:t,onReasoningPart:o,onReasoningSignaturePart:i,onRedactedReasoningPart:p,onSourcePart:E,onFilePart:m,onDataPart:f,onErrorPart:a,onToolCallStreamingStartPart:n,onToolCallDeltaPart:u,onToolCallPart:l,onToolResultPart:S,onMessageAnnotationsPart:R,onFinishMessagePart:C,onFinishStepPart:O,onStartStepPart:k}){const b=e.getReader(),D=new TextDecoder,P=[];let L=0;for(;;){const{value:d}=await b.read();if(d&&(P.push(d),L+=d.length,d[d.length-1]!==It))continue;if(P.length===0)break;const c=Tt(P,L);L=0;const I=D.decode(c,{stream:!0}).split(`
`).filter(A=>A!=="").map(ht);for(const{type:A,value:T}of I)switch(A){case"text":await(t==null?void 0:t(T));break;case"reasoning":await(o==null?void 0:o(T));break;case"reasoning_signature":await(i==null?void 0:i(T));break;case"redacted_reasoning":await(p==null?void 0:p(T));break;case"file":await(m==null?void 0:m(T));break;case"source":await(E==null?void 0:E(T));break;case"data":await(f==null?void 0:f(T));break;case"error":await(a==null?void 0:a(T));break;case"message_annotations":await(R==null?void 0:R(T));break;case"tool_call_streaming_start":await(n==null?void 0:n(T));break;case"tool_call_delta":await(u==null?void 0:u(T));break;case"tool_call":await(l==null?void 0:l(T));break;case"tool_result":await(S==null?void 0:S(T));break;case"finish_message":await(C==null?void 0:C(T));break;case"finish_step":await(O==null?void 0:O(T));break;case"start_step":await(k==null?void 0:k(T));break;default:{const Y=A;throw new Error(`Unknown stream part type: ${Y}`)}}}}async function Rt({stream:e,update:t,onToolCall:o,onFinish:i,generateId:p=Ae,getCurrentDate:E=()=>new Date,lastMessage:m}){var f,a;const n=(m==null?void 0:m.role)==="assistant";let u=n?1+((a=(f=m.toolInvocations)==null?void 0:f.reduce((c,I)=>{var A;return Math.max(c,(A=I.step)!=null?A:0)},0))!=null?a:0):0;const l=n?structuredClone(m):{id:p(),createdAt:E(),role:"assistant",content:"",parts:[]};let S,R,C;function O(c,I){const A=l.parts.find(T=>T.type==="tool-invocation"&&T.toolInvocation.toolCallId===c);A!=null?A.toolInvocation=I:l.parts.push({type:"tool-invocation",toolInvocation:I})}const k=[];let b=n?m==null?void 0:m.annotations:void 0;const D={};let P={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},L="unknown";function d(){const c=[...k];b!=null&&b.length&&(l.annotations=b);const I={...structuredClone(l),revisionId:p()};t({message:I,data:c,replaceLastMessage:n})}await wt({stream:e,onTextPart(c){S==null?(S={type:"text",text:c},l.parts.push(S)):S.text+=c,l.content+=c,d()},onReasoningPart(c){var I;C==null?(C={type:"text",text:c},R!=null&&R.details.push(C)):C.text+=c,R==null?(R={type:"reasoning",reasoning:c,details:[C]},l.parts.push(R)):R.reasoning+=c,l.reasoning=((I=l.reasoning)!=null?I:"")+c,d()},onReasoningSignaturePart(c){C!=null&&(C.signature=c.signature)},onRedactedReasoningPart(c){R==null&&(R={type:"reasoning",reasoning:"",details:[]},l.parts.push(R)),R.details.push({type:"redacted",data:c.data}),C=void 0,d()},onFilePart(c){l.parts.push({type:"file",mimeType:c.mimeType,data:c.data}),d()},onSourcePart(c){l.parts.push({type:"source",source:c}),d()},onToolCallStreamingStartPart(c){l.toolInvocations==null&&(l.toolInvocations=[]),D[c.toolCallId]={text:"",step:u,toolName:c.toolName,index:l.toolInvocations.length};const I={state:"partial-call",step:u,toolCallId:c.toolCallId,toolName:c.toolName,args:void 0};l.toolInvocations.push(I),O(c.toolCallId,I),d()},onToolCallDeltaPart(c){const I=D[c.toolCallId];I.text+=c.argsTextDelta;const{value:A}=et(I.text),T={state:"partial-call",step:I.step,toolCallId:c.toolCallId,toolName:I.toolName,args:A};l.toolInvocations[I.index]=T,O(c.toolCallId,T),d()},async onToolCallPart(c){const I={state:"call",step:u,...c};if(D[c.toolCallId]!=null?l.toolInvocations[D[c.toolCallId].index]=I:(l.toolInvocations==null&&(l.toolInvocations=[]),l.toolInvocations.push(I)),O(c.toolCallId,I),d(),o){const A=await o({toolCall:c});if(A!=null){const T={state:"result",step:u,...c,result:A};l.toolInvocations[l.toolInvocations.length-1]=T,O(c.toolCallId,T),d()}}},onToolResultPart(c){const I=l.toolInvocations;if(I==null)throw new Error("tool_result must be preceded by a tool_call");const A=I.findIndex(Y=>Y.toolCallId===c.toolCallId);if(A===-1)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");const T={...I[A],state:"result",...c};I[A]=T,O(c.toolCallId,T),d()},onDataPart(c){k.push(...c),d()},onMessageAnnotationsPart(c){b==null?b=[...c]:b.push(...c),d()},onFinishStepPart(c){u+=1,S=c.isContinued?S:void 0,R=void 0,C=void 0},onStartStepPart(c){n||(l.id=c.messageId)},onFinishMessagePart(c){L=c.finishReason,c.usage!=null&&(P=Qe(c.usage))},onErrorPart(c){throw new Error(c)}}),i==null||i({message:l,finishReason:L,usage:P})}async function St({stream:e,onTextPart:t}){const o=e.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:i,value:p}=await o.read();if(i)break;await t(p)}}async function At({stream:e,update:t,onFinish:o,getCurrentDate:i=()=>new Date,generateId:p=Ae}){const E={type:"text",text:""},m={id:p(),createdAt:i(),role:"assistant",content:"",parts:[E]};await St({stream:e,onTextPart:f=>{m.content+=f,E.text+=f,t({message:{...m},data:[],replaceLastMessage:!1})}}),o==null||o(m,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"})}var vt=()=>fetch;async function Ot({api:e,body:t,streamProtocol:o="data",credentials:i,headers:p,abortController:E,restoreMessagesOnFailure:m,onResponse:f,onUpdate:a,onFinish:n,onToolCall:u,generateId:l,fetch:S=vt(),lastMessage:R}){var C,O;const k=await S(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...p},signal:(C=E==null?void 0:E())==null?void 0:C.signal,credentials:i}).catch(b=>{throw m(),b});if(f)try{await f(k)}catch(b){throw b}if(!k.ok)throw m(),new Error((O=await k.text())!=null?O:"Failed to fetch the chat response.");if(!k.body)throw new Error("The response body is empty.");switch(o){case"text":{await At({stream:k.body,update:a,onFinish:n,generateId:l});return}case"data":{await Rt({stream:k.body,update:a,lastMessage:R,onToolCall:u,onFinish({message:b,finishReason:D,usage:P}){n&&b!=null&&n(b,{usage:P,finishReason:D})},generateId:l});return}default:{const b=o;throw new Error(`Unknown stream protocol: ${b}`)}}}function le(e){return e==null?void 0:e.reduce((t,o)=>{var i;return Math.max(t,(i=o.step)!=null?i:0)},0)}function Ct(e){var t;return(t=e.parts)!=null?t:[...e.toolInvocations?e.toolInvocations.map(o=>({type:"tool-invocation",toolInvocation:o})):[],...e.reasoning?[{type:"reasoning",reasoning:e.reasoning,details:[{type:"text",text:e.reasoning}]}]:[],...e.content?[{type:"text",text:e.content}]:[]]}function xt(e){return e.map(t=>({...t,parts:Ct(t)}))}function fe(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(typeof e!="object"&&typeof t!="object")return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let p=0;p<e.length;p++)if(!fe(e[p],t[p]))return!1;return!0}const o=Object.keys(e),i=Object.keys(t);if(o.length!==i.length)return!1;for(const p of o)if(!i.includes(p)||!fe(e[p],t[p]))return!1;return!0}async function Dt(e){if(!e)return[];if(e instanceof FileList)return Promise.all(Array.from(e).map(async t=>{const{name:o,type:i}=t,p=await new Promise((E,m)=>{const f=new FileReader;f.onload=a=>{var n;E((n=a.target)==null?void 0:n.result)},f.onerror=a=>m(a),f.readAsDataURL(t)});return{name:o,contentType:i,url:p}}));if(Array.isArray(e))return e;throw new Error("Invalid attachments type")}function Pt({originalMaxToolInvocationStep:e,originalMessageCount:t,maxSteps:o,messages:i}){var p;const E=i[i.length-1];return o>1&&E!=null&&(i.length>t||le(E.toolInvocations)!==e)&&kt(E)&&!bt(E)&&((p=le(E.toolInvocations))!=null?p:0)<o}function bt(e){let t=!1;return e.parts.forEach(o=>{o.type==="text"&&(t=!0),o.type==="tool-invocation"&&(t=!1)}),t}function kt(e){return e.role==="assistant"&&e.parts.filter(t=>t.type==="tool-invocation").every(t=>"result"in t.toolInvocation)}function Lt({messages:e,toolCallId:t,toolResult:o}){var i;const p=e[e.length-1],E=p.parts.find(f=>f.type==="tool-invocation"&&f.toolInvocation.toolCallId===t);if(E==null)return;const m={...E.toolInvocation,state:"result",result:o};E.toolInvocation=m,p.toolInvocations=(i=p.toolInvocations)==null?void 0:i.map(f=>f.toolCallId===t?m:f)}export{Nt as a,Ae as b,Ot as c,Ct as d,le as e,xt as f,Ne as g,fe as h,kt as i,Dt as p,xe as r,Pt as s,Lt as u};
